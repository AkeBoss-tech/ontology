ontology:
  # Interfaces
  interfaces:
    - id: "Location"
      displayName: "Location"
      properties:
        - id: "latitude"
          type: "double"
          required: true
          description: "Latitude coordinate"
          unit: "degrees"
        - id: "longitude"
          type: "double"
          required: true
          description: "Longitude coordinate"
          unit: "degrees"
      requiredLinkTypes: []

  objectTypes:
    - id: "aircraft"
      displayName: "Aircraft"
      primaryKey: "tail_number"
      implements: []
      properties:
        - id: "tail_number"
          type: "string"
          required: true
          description: "Unique tail number identifier"
        - id: "model"
          type: "string"
          description: "Aircraft model"
        - id: "flight_hours"
          type: "double"
          description: "Total flight hours"
          unit: "hours"
          format:
            type: "number_format"
            decimals: 2
        - id: "last_maintenance"
          type: "date"
          description: "Date of last maintenance"
          format:
            type: "date_format"
            format: "%Y-%m-%d"
        - id: "tags"
          type:
            type: "array"
            elementType: "string"
          description: "Tags associated with the aircraft"
        - id: "metadata"
          type:
            type: "map"
            keyType: "string"
            valueType: "string"
          description: "Additional metadata"
      backingDatasource: "s3://clean-data/aircraft_fleet"
      titleKey: "tail_number"

    - id: "maintenance_event"
      displayName: "Maintenance Event"
      primaryKey: "event_id"
      implements: []
      properties:
        - id: "event_id"
          type: "string"
          required: true
        - id: "description"
          type: "string"
        - id: "date"
          type: "date"
        - id: "status"
          type: "string"
        - id: "cost"
          type: "double"
          unit: "USD"
          format:
            type: "currency"
            symbol: "$"
        - id: "address"
          type:
            type: "object"
            id: "Address"
            fields:
              - id: "street"
                type: "string"
              - id: "city"
                type: "string"
              - id: "state"
                type: "string"
          description: "Maintenance facility address"
      titleKey: "event_id"

    - id: "office"
      displayName: "Office"
      primaryKey: "id"
      implements: ["Location"]
      properties:
        - id: "id"
          type: "string"
          required: true
        - id: "name"
          type: "string"
          required: true
        - id: "latitude"
          type: "double"
          required: true
        - id: "longitude"
          type: "double"
          required: true
      titleKey: "name"

  linkTypes:
    - id: "aircraft_has_history"
      displayName: "Aircraft Has History"
      source: "aircraft"
      target: "maintenance_event"
      cardinality: "ONE_TO_MANY"
      bidirectional: true

  actionTypes:
    - id: "schedule_maintenance"
      displayName: "Schedule Maintenance"
      parameters:
        - id: "target_aircraft"
          type: "object_reference"
          required: true
        - id: "date"
          type: "date"
          required: true
        - id: "description"
          type: "string"
      logic:
        - operation: "create_object"
          type: "maintenance_event"
          properties:
            date: "{{date}}"
            status: "Scheduled"
            description: "{{description}}"
        - operation: "create_link"
          linkType: "aircraft_has_history"
          from: "{{target_aircraft}}"
          to: "new_maintenance_event"

  functionTypes:
    - id: "calculate_total_maintenance_cost"
      displayName: "Calculate Total Maintenance Cost"
      description: "Sums the cost of all maintenance events for an aircraft"
      parameters:
        - id: "aircraft_id"
          type: "object_reference"
          required: true
      returnType:
        type: "property"
        propertyType: "double"
      logic:
        type: "aggregation"
        linkType: "aircraft_has_history"
        aggregation: "sum"
        property: "cost"
      cacheable: true

    - id: "get_maintenance_events"
      displayName: "Get Maintenance Events"
      description: "Get all maintenance events linked to an aircraft"
      parameters:
        - id: "aircraft_id"
          type: "object_reference"
          required: true
      returnType:
        type: "array"
        elementType:
          type: "object_type"
          objectType: "maintenance_event"
      logic:
        type: "link_traversal"
        linkType: "aircraft_has_history"
        targetType: "maintenance_event"
        filter: null
      cacheable: false



